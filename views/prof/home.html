{{extend 'layout.html'}}

<table>
	<tr>
		<td rowspan='2'>
			{{=A(IMG(_width='50px', _src=URL('download', args=prof.picture)), 
			_href=URL('home', vars=dict(id=prof.id)))}}
		</td>
		<td>
			<table>
				<tr>
					<h2>{{=prof.full_name}}</h2>
				</tr>
				<tr>
					{{=prof.email}}
				</tr>
			</table>
		</td>
		<td>
			<div style="font-size:50px">
				<b>{{=prof.grade or ''}}</b>
			</div>
		</td>
	</tr>
</table>
<br/>
<i>{{='nenhuma avaliação' if not len(evals) else ''}}</i>
<br/>

{{for eval in evals:}}
<div class='grade{{=eval['grade']}}'>
	<table>
		<tr>
			<td rowspan='4'>
				<div style='font-size:xx-large'>
					<b>{{=eval['grade']}}</b>
				</div>
			</td>
			<td>
				<table>
					<tr>
							<b>{{=eval['aluno_name']}}</b>, sobre <b>{{=eval['disc_name']}}</b> em <b>{{=eval['semester']}}</b>:
					</tr>
					<tr>
						<td>
							<i>{{=eval['comment'] or 'sem comentário'}}</i><br />
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<div style='float:right'>
			<b>
				{{if not has_karmed(get_aluno_id(), eval['id']) and get_aluno_id()!=eval['aluno_id']:}}
					<form><input type="hidden" id="karma{{=eval['id']}}"/></form>

					<span id="plus{{=eval['id']}}" style="float:right" 
						onclick="ajax('{{=URL(request.application, 'karma', 'up', vars=dict(eval_id=eval['id']))}}', 
						['karma{{=eval['id']}}'], 'karma_count{{=eval['id']}}');
						jQuery('#plus{{=eval['id']}}').fadeOut();
						jQuery('#minus{{=eval['id']}}').fadeOut();">
						(+)</span>

					<span style="float:right" id='karma_count{{=eval['id']}}'>{{=eval['karma']}}</span>

					<span id="minus{{=eval['id']}}" style="float:right" 
						onclick="ajax('{{=URL(request.application, 'karma', 'down', vars=dict(eval_id=eval['id']))}}', 
						['karma{{=eval['id']}}'], 'karma_count{{=eval['id']}}');
						jQuery('#plus{{=eval['id']}}').fadeOut();
						jQuery('#minus{{=eval['id']}}').fadeOut();">
						(-)</span>
				{{else:}}
				<span style="float:right">{{=eval['karma']}}</span>
				{{pass}}
			</b>
		</div>
		{{if session.auth:}}
			{{if eval['aluno_user_id'] == session.auth.user.id:}}
				{{=A('Editar', _href=URL(request.application, 'eval', 'update', vars=dict(eval_id=eval['id'], prof_id=prof.id)))}}<br />
			{{pass}}
		{{pass}}
		</tr>
	</table>
</div><br/>
{{pass}}<br/>

{{=A('Adicionar avaliação', _href=URL(request.application, 'eval', 'create', vars=dict(prof_id=prof.id)))}}

