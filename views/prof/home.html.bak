{{extend 'layout.html'}}

<script>
    jQuery(document).ready(function(){jQuery('.discs_list').hide()});
</script>

<table>
    <tr>
        <td rowspan='2'>
            {{if prof.picture:}}
                {{=A(IMG(_width='100px', _src=URL('download', args=prof.picture)), 
                    _href=URL('home', vars=dict(id=prof.id)))}}
            {{else:}}
                {{=A(IMG(_width='100px', _src=URL(request.application, 'static/profs', 
                        prof.email.split('@')[0]+'.jpg')),
                    _href=URL('home', vars=dict(id=prof.id)))}}
            {{pass}}
        </td>
        <td>
            <table>
                <tr>
                    <h2>{{=prof.full_name}}</h2>
                </tr>
                <tr>
                    {{=prof.email}}<br />
                    {{if prof.site:}} 
                        {{=A(prof.site, _href=prof.site, _target="_blank")}}
                    {{pass}}
                </tr>
            </table>
        </td>
        <td>
            <div style="font-size:50px">
                <b>{{=prof.grade or ''}}</b>
            </div>
        </td>
    </tr>
</table>

{{if len(evals)>0:}}        
    <div style="padding:15px;">
        <table class="infotable">
            <th colspan=2 class="infoheader">Estatísticas de {{=prof.short_name}}:</th>
            <tr>
                <td style="text-align:center">
                    <b>Evolução</b>
                </td>
                <td style="text-align:center">
                    <b>Avaliações recebidas</b>
                </td>
            </tr>
            <tr>
                <td>                            
                    <img src="{{=graph_grades(evals_stats)}}">
                </td>
                <td>                            
                    <img src="{{=graph_evolution_evals(prof_evals)}}">
                </td>
            </tr>
        </table>
    </div>
{{pass}}

<h4 class="discs_toggle cursored padded10" onclick="jQuery('.discs_list').slideToggle()">
     {{=T('Disciplinas ministradas por ')}}{{=prof.short_name}}
     {{=IMG(_src=URL('static', 'plus.png'))}}
</h4>
<div class="discs_list">
    {{if len(discs)>0:}}
        <table>
        <tr>
            <th>{{=T('Disciplina')}}</th>
            <th>{{=T('Média de')}} {{=prof.short_name}}</th>
        </tr>
        {{for i, disc in enumerate(discs):}}
            <tr class="{{=['even', 'odd'][i % 2]}}">
                <td>{{=A(disc['name'],
                    _href=URL(request.application,'disc','home',vars=dict(disc_id=disc['id'])))}}</td>
                <td>
                    <b>{{=disc['grade'] if not disc['grade'] == '\\' else '-'}}</b>
                </td>
            </tr>
        {{pass}}
        </table>
    {{pass}}
</div>


<i>{{='nenhuma avaliação' if not len(evals) else ''}}</i>
<br/>
{{include "eval/list.html"}}

{{if not auth.has_membership('Professor'):}}
    {{if 'prof_id' in request.vars:}}
        {{=A('Adicionar avaliação', _href=URL(request.application, 'eval', 'create', vars=dict(prof_id=prof.id)))}}
    {{else:}}
        {{=A('Adicionar avaliação', _href=URL(request.application, 'eval', 'create', vars=dict(disc_id=disc.id)))}}
    {{pass}}
{{pass}}
