{{extend 'layout.html'}}

<form id='search' name='search' action="">
	<table>
		<tr>
			<th>Professor</th>
			<th>Disciplina</th>
		</tr>
		<tr>
			<td>{{=fields['prof']}}</td>
			<td>{{=fields['disc']}}</td>
		</tr>
		<tr>
			<th>Ano</th>
			<th>Nota</th>
		</tr>
		<tr>
			<td>{{=fields['year']}}</td>
			<td>{{=fields['grade']}}</td>
			<td><input type="submit" value="Buscar!" style="float:right"/></td>
		</tr>
	</table>
	<br/><br/>
</form>

{{if len(evals):}}

	{{if page:}}
		<a style="float:left" href="{{=URL(args=[page-1], vars=request.vars)}}">{{=T('<anterior')}}</a>
	{{pass}}

	{{if len(evals) > per_page:}}
		<a style="float:right" href="{{=URL(args=[page+1], vars=request.vars)}}">{{=T('próxima>')}}</a>
	{{pass}}

	<br/>

	{{for i, eval in enumerate(evals):}}
		{{if i==per_page: break}}
		<div class='grade{{=eval['grade']}}'>
				<table>
						<tr>
								<td rowspan='4'>
										<div style='font-size:xx-large'>
												<b>{{=eval['grade']}}</b>
										</div>
								</td>
								<td>
									<table>
										<tr>
											{{if not eval['anonimo']:}}
												{{=B(A(eval['aluno_name'], _href=URL(request.application, 'profile', 
												'home', vars=dict(aluno_id=eval['aluno_id']))))}}
											{{else:}}
												{{=B(T('Anônimo'))}}
											{{pass}}
											sobre
											{{=B(A(eval['prof_name'], _href=URL(request.application, 'prof', 'home',
											vars=dict(prof_id=eval['prof_id']))))}}
											por
											{{=B(A(eval['disc_name'], _href=URL(request.application, 'disc',
											'home', vars=dict(disc_id=eval['disc_id']))))}}
											{{if 'semester' in eval:}}
												em
												{{=B(eval['semester'])}}
											{{pass}}
											:
										</tr>
										<tr>
											<td>
												<i>{{=eval['comment'] or T('sem comentário')}}</i><br />
											</td>
										</tr>
									</table>
								</td>
						</tr>
						<div style='float:right'>
								<b>
										{{if not has_karmed(get_aluno_id(), eval['id']) and get_aluno_id() and get_aluno_id()!=eval['aluno_id']:}}
												<form><input type="hidden" id="karma{{=eval['id']}}"/></form>

												<span id="plus{{=eval['id']}}" style="float:right; cursor:hand; cursor:pointer" 
														onclick="ajax('{{=URL(request.application, 'karma', 'up', vars=dict(eval_id=eval['id']))}}', 
														['karma{{=eval['id']}}'], 'karma_count{{=eval['id']}}');
														jQuery('#plus{{=eval['id']}}').fadeOut();
														jQuery('#minus{{=eval['id']}}').fadeOut();">
														{{=IMG(_src=URL('static', 'thumb-up.png'))}}
												</span>

												<span style="float:right" id="karma_count{{=eval['id']}}" 
														class="karma-{{='plus' if eval['karma'] >= 0 else 'minus'}}">{{=eval['karma']}}</span>

												<span id="minus{{=eval['id']}}" style="float:right; cursor:hand; cursor:pointer" 
														onclick="ajax('{{=URL(request.application, 'karma', 'down', vars=dict(eval_id=eval['id']))}}', 
														['karma{{=eval['id']}}'], 'karma_count{{=eval['id']}}');
														jQuery('#plus{{=eval['id']}}').fadeOut();
														jQuery('#minus{{=eval['id']}}').fadeOut();">
														{{=IMG(_src=URL('static', 'thumb-down.png'))}}</span>
										{{else:}}
												<span style="float:right" class="karma-{{='plus' if eval['karma'] >= 0 else 'minus'}}">{{=eval['karma']}}</span>
										{{pass}}
								</b>
						</div>
						{{if session.auth:}}
								{{if eval['aluno_user_id'] == session.auth.user.id:}}
										{{if 'prof_id' in eval:}}
												{{=A(IMG(_src=URL('static', 'cross.png'), _border=0, _alt='Excluir'), _title='Excluir', 
														_href=URL(request.application, 'eval', 'delete', vars=dict(eval_id=eval['id'], prof_id=eval['prof_id'])),
														_onclick="return confirm('Tem certeza de que deseja excluir a avaliação?');")}}
												{{=A(IMG(_src=URL('static', 'pencil.png'), _border=0, _alt='Excluir'), _title='Editar',
														_href=URL(request.application, 'eval', 'update', vars=dict(eval_id=eval['id'], prof_id=eval['prof_id'])))}}
										{{elif 'disc_id' in eval:}}
												{{=A(IMG(_src=URL('static', 'cross.png'), _border=0, _alt='Excluir'), _title='Excluir', 
														_href=URL(request.application, 'eval', 'delete', vars=dict(eval_id=eval['id'], disc_id=eval['disc_id'])),
														_onclick="return confirm('Tem certeza de que deseja excluir a avaliação?');")}}
												{{=A(IMG(_src=URL('static', 'pencil.png'), _border=0, _alt='Excluir'), _title='Editar',
														_href=URL(request.application, 'eval', 'update', vars=dict(eval_id=eval['id'], disc_id=eval['disc_id'])))}}
										{{pass}}
								{{pass}}
						{{pass}}
						</tr>
						<div style="float:right"><br/><br/><br/>
								{{if get_prof_id() == eval['prof_id']:}}
										{{=A('Responder', _href=URL(request.application, 'eval', 'reply', vars=dict(prof_id=eval['prof_id'], eval_id=eval['id'])))}}
								{{pass}}
						</div>
				</table>
						{{if eval['reply']:}}
						<div style="padding:10px; background-color:#999999;">
								<b>Resposta: </b>
										{{=eval['reply']}}
								</div>
						{{pass}}
		</div><br/>
	{{pass}}<br/>

{{else:}}
	<br/>
{{pass}}

